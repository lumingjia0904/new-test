<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for lib/qinius/qiniu.min.js</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../../prettify.css" />
    <link rel="stylesheet" href="../../base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="../../index.html">All files</a> / <a href="index.html">lib/qinius</a> qiniu.min.js
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>0/501</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>0/532</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>0/73</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>0/1</span>
      </div>
    </div>
  </div>
  <div class='status-line low'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3</td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">/*! qiniu-js v1.0.22 | Copyright 2015 by Qiniu */
<span class="cstat-no" title="statement not covered" >!<span class="fstat-no" title="function not covered" >function(</span>global){function <span class="fstat-no" title="function not covered" >createCookie(a,b,c){var d=<span class="cstat-no" title="statement not covered" >new Date;<span class="cstat-no" title="statement not covered" >d.setTime(d.getTime()+24*c*60*60*1e3);v</span>ar e=<span class="cstat-no" title="statement not covered" >"; expires="+d.toGMTString();<span class="cstat-no" title="statement not covered" >document.cookie=a+"="+b+e+"; path=/"}f</span>unction <span class="fstat-no" title="function not covered" >readCookie(a){var b=<span class="cstat-no" title="statement not covered" >a+"=";var c=<span class="cstat-no" title="statement not covered" >document.cookie.split(";");<span class="cstat-no" title="statement not covered" >for(var d=0,e=c.length;e&gt;d;d++){var f=<span class="cstat-no" title="statement not covered" >c[d];<span class="cstat-no" title="statement not covered" >while(" "===f.charAt(0))<span class="cstat-no" title="statement not covered" >f=f.substring(1,f.length);<span class="cstat-no" title="statement not covered" >i</span></span>f(0===f.indexOf(b))<span class="cstat-no" title="statement not covered" >return f.substring(b.length,f.length)}<span class="cstat-no" title="statement not covered" >r</span></span></span>eturn null}<span class="cstat-no" title="statement not covered" >w</span>indow.localStorage||(window.localStorage={setItem:<span class="fstat-no" title="function not covered" >function(</span>a,b){<span class="cstat-no" title="statement not covered" >createCookie(a,b,30)},</span>getItem:<span class="fstat-no" title="function not covered" >function(</span>a){<span class="cstat-no" title="statement not covered" >return readCookie(a)},</span>removeItem:<span class="fstat-no" title="function not covered" >function(</span>a){<span class="cstat-no" title="statement not covered" >createCookie(a,"",-1)}}</span>);f</span>unction <span class="fstat-no" title="function not covered" >QiniuJsSDK(){var that=<span class="cstat-no" title="statement not covered" >this;<span class="cstat-no" title="statement not covered" >this.detectIEVersion=<span class="fstat-no" title="function not covered" >function()</span>{var a=<span class="cstat-no" title="statement not covered" >4,b=<span class="cstat-no" title="statement not covered" >document.createElement("div"),c=<span class="cstat-no" title="statement not covered" >b.getElementsByTagName("i");<span class="cstat-no" title="statement not covered" >while(b.innerHTML="&lt;!--[if gt IE "+a+"]&gt;&lt;i&gt;&lt;/i&gt;&lt;![endif]--&gt;",c[0])<span class="cstat-no" title="statement not covered" >a++;<span class="cstat-no" title="statement not covered" >r</span></span>eturn a&gt;4?a:!1};</span>v</span>ar logger=<span class="cstat-no" title="statement not covered" >{MUTE:0,FATA:1,ERROR:2,WARN:3,INFO:4,DEBUG:5,TRACE:6,level:0};function <span class="fstat-no" title="function not covered" >log(a,b){var c=<span class="cstat-no" title="statement not covered" >"[qiniu-js-sdk]["+a+"]";var d=<span class="cstat-no" title="statement not covered" >c;<span class="cstat-no" title="statement not covered" >for(var e=0;e&lt;b.length;e++)<span class="cstat-no" title="statement not covered" >d+="string"==typeof b[e]?" "+b[e]:" "+that.stringifyJSON(b[e]);<span class="cstat-no" title="statement not covered" >t</span></span>hat.detectIEVersion()?console.log(d):(b.unshift(c),console.log.apply(console,b)),document.getElementById("qiniu-js-sdk-log")&amp;&amp;(document.getElementById("qiniu-js-sdk-log").innerHTML+="&lt;p&gt;"+d+"&lt;/p&gt;")}f</span>unction <span class="fstat-no" title="function not covered" >makeLogFunc(a){var b=<span class="cstat-no" title="statement not covered" >a.toLowerCase();<span class="cstat-no" title="statement not covered" >logger[b]=<span class="fstat-no" title="function not covered" >function()</span>{<span class="cstat-no" title="statement not covered" >if(window.console&amp;&amp;window.console.log&amp;&amp;logger.level&gt;=logger[a]){var c=<span class="cstat-no" title="statement not covered" >Array.prototype.slice.call(arguments);<span class="cstat-no" title="statement not covered" >log(b,c)}}</span>}<span class="cstat-no" title="statement not covered" ></span>f</span>or(var property in logger)<span class="cstat-no" title="statement not covered" >logger.hasOwnProperty(property)&amp;&amp;"number"==typeof logger[property]&amp;&amp;!logger.hasOwnProperty(property.toLowerCase())&amp;&amp;makeLogFunc(property);v</span></span>ar qiniuUploadUrl;<span class="cstat-no" title="statement not covered" >qiniuUploadUrl="https:"===window.location.protocol?"https://up.qbox.me":"http://upload.qiniu.com";v</span>ar qiniuUploadUrls=<span class="cstat-no" title="statement not covered" >["http://upload.qiniu.com","http://up.qiniu.com"];var qiniuUpHosts=<span class="cstat-no" title="statement not covered" >{http:["http://upload.qiniu.com","http://up.qiniu.com"],https:["https://up.qbox.me"]};var changeUrlTimes=<span class="cstat-no" title="statement not covered" >0;function <span class="fstat-no" title="function not covered" >StatisticsLogger(){var a=<span class="cstat-no" title="statement not covered" >"https://uplog.qbox.me/log/3";var b=<span class="cstat-no" title="statement not covered" >[];var c=<span class="cstat-no" title="statement not covered" >{waiting:0,processing:1,finished:2};<span class="cstat-no" title="statement not covered" >this.log=<span class="fstat-no" title="function not covered" >function(</span>a,d,e,f,g,h,i,j,k,l){var m=<span class="cstat-no" title="statement not covered" >Array.prototype.join.call(arguments,",");<span class="cstat-no" title="statement not covered" >b.push({log:m,status:c.waiting}),logger.debug("[STATISTICS] send log to statistics server",m)};</span>f</span>unction <span class="fstat-no" title="function not covered" >d(){var a=<span class="cstat-no" title="statement not covered" >[];<span class="cstat-no" title="statement not covered" >for(var d=0;d&lt;b.length;d++)<span class="cstat-no" title="statement not covered" >b[d].status!==c.finished&amp;&amp;a.push(b[d]),b[d].status===c.waiting&amp;&amp;e(b[d]);<span class="cstat-no" title="statement not covered" >b</span></span>=a}f</span>unction <span class="fstat-no" title="function not covered" >e(b){<span class="cstat-no" title="statement not covered" >b.status=c.processing;v</span>ar d=<span class="cstat-no" title="statement not covered" >that.createAjax();<span class="cstat-no" title="statement not covered" >d.open("POST",a,!0),d.setRequestHeader("Content-type","application/x-www-form-urlencoded"),d.setRequestHeader("Authorization","UpToken "+that.token),d.onreadystatechange=<span class="fstat-no" title="function not covered" >function()</span>{<span class="cstat-no" title="statement not covered" >4===d.readyState&amp;&amp;(200===d.status?(logger.debug("[STATISTICS] successfully report log to server"),b.status=c.finished):(logger.debug("[STATISTICS] report log to server failed"),b.status=c.waiting))},</span>d.send(b.log)}<span class="cstat-no" title="statement not covered" >s</span>etInterval(d,1e3)}v</span>ar statisticsLogger=<span class="cstat-no" title="statement not covered" >new StatisticsLogger;var ExtraErrors=<span class="cstat-no" title="statement not covered" >{ZeroSizeFile:-6,InvalidToken:-5,InvalidArgument:-4,InvalidFile:-3,Cancelled:-2,NetworkError:-1,UnknownError:0,TimedOut:-1001,UnknownHost:-1003,CannotConnectToHost:-1004,NetworkConnectionLost:-1005};<span class="cstat-no" title="statement not covered" >this.resetUploadUrl=<span class="fstat-no" title="function not covered" >function()</span>{var a=<span class="cstat-no" title="statement not covered" >"https:"===window.location.protocol?qiniuUpHosts.https:qiniuUpHosts.http;var b=<span class="cstat-no" title="statement not covered" >changeUrlTimes%a.length;<span class="cstat-no" title="statement not covered" >qiniuUploadUrl=a[b],changeUrlTimes++,logger.debug("resetUploadUrl: "+qiniuUploadUrl)},</span>this.isImage=<span class="fstat-no" title="function not covered" >function(</span>a){<span class="cstat-no" title="statement not covered" >return a=a.split(/[?#]/)[0],/\.(png|jpg|jpeg|gif|bmp)$/i.test(a)},</span>this.getFileExtension=<span class="fstat-no" title="function not covered" >function(</span>a){var b=<span class="cstat-no" title="statement not covered" >a.split(".");var c;<span class="cstat-no" title="statement not covered" >return c=1===b.length||""===b[0]&amp;&amp;2===b.length?"":b.pop().toLowerCase()},</span>this.utf8_encode=<span class="fstat-no" title="function not covered" >function(</span>a){<span class="cstat-no" title="statement not covered" >if(null===a||"undefined"==typeof a)<span class="cstat-no" title="statement not covered" >return"";v</span></span>ar b=<span class="cstat-no" title="statement not covered" >a+"";var c=<span class="cstat-no" title="statement not covered" >"",d,e,f=<span class="cstat-no" title="statement not covered" >0;<span class="cstat-no" title="statement not covered" >d=e=0,f=b.length;<span class="cstat-no" title="statement not covered" >f</span>or(var g=0;f&gt;g;g++){var h=<span class="cstat-no" title="statement not covered" >b.charCodeAt(g);var i=<span class="cstat-no" title="statement not covered" >null;<span class="cstat-no" title="statement not covered" >if(128&gt;h)<span class="cstat-no" title="statement not covered" >e++;else <span class="cstat-no" title="statement not covered" >if(h&gt;127&amp;&amp;2048&gt;h)<span class="cstat-no" title="statement not covered" >i=String.fromCharCode(h&gt;&gt;6|192,63&amp;h|128);else <span class="cstat-no" title="statement not covered" >if(63488&amp;h^!0)<span class="cstat-no" title="statement not covered" >i=String.fromCharCode(h&gt;&gt;12|224,h&gt;&gt;6&amp;63|128,63&amp;h|128);else{<span class="cstat-no" title="statement not covered" >if(64512&amp;h^!0)<span class="cstat-no" title="statement not covered" >throw new RangeError("Unmatched trail surrogate at "+g);v</span></span>ar j=<span class="cstat-no" title="statement not covered" >b.charCodeAt(++g);<span class="cstat-no" title="statement not covered" >if(64512&amp;j^!0)<span class="cstat-no" title="statement not covered" >throw new RangeError("Unmatched lead surrogate at "+(g-1));<span class="cstat-no" title="statement not covered" >h</span></span>=((1023&amp;h)&lt;&lt;10)+(1023&amp;j)+65536,i=String.fromCharCode(h&gt;&gt;18|240,h&gt;&gt;12&amp;63|128,h&gt;&gt;6&amp;63|128,63&amp;h|128)}<span class="cstat-no" title="statement not covered" >n</span></span></span></span>ull!==i&amp;&amp;(e&gt;d&amp;&amp;(c+=b.slice(d,e)),c+=i,d=e=g+1)}<span class="cstat-no" title="statement not covered" >r</span></span>eturn e&gt;d&amp;&amp;(c+=b.slice(d,f)),c},</span>this.base64_decode=<span class="fstat-no" title="function not covered" >function(</span>a){var b=<span class="cstat-no" title="statement not covered" >"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";var c,d,e,f,g,h,i,j,k=<span class="cstat-no" title="statement not covered" >0,l=<span class="cstat-no" title="statement not covered" >0,m=<span class="cstat-no" title="statement not covered" >"",n=<span class="cstat-no" title="statement not covered" >[];<span class="cstat-no" title="statement not covered" >if(!a)<span class="cstat-no" title="statement not covered" >return a;<span class="cstat-no" title="statement not covered" >a</span></span>+="";<span class="cstat-no" title="statement not covered" >d</span>o <span class="cstat-no" title="statement not covered" >f=b.indexOf(a.charAt(k++)),g=b.indexOf(a.charAt(k++)),h=b.indexOf(a.charAt(k++)),i=b.indexOf(a.charAt(k++)),j=f&lt;&lt;18|g&lt;&lt;12|h&lt;&lt;6|i,c=j&gt;&gt;16&amp;255,d=j&gt;&gt;8&amp;255,e=255&amp;j,64===h?n[l++]=String.fromCharCode(c):64===i?n[l++]=String.fromCharCode(c,d):n[l++]=String.fromCharCode(c,d,e);while(k&lt;a.length);<span class="cstat-no" title="statement not covered" >r</span>eturn m=n.join("")},</span>this.base64_encode=<span class="fstat-no" title="function not covered" >function(</span>a){var b=<span class="cstat-no" title="statement not covered" >"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";var c,d,e,f,g,h,i,j,k=<span class="cstat-no" title="statement not covered" >0,l=<span class="cstat-no" title="statement not covered" >0,m=<span class="cstat-no" title="statement not covered" >"",n=<span class="cstat-no" title="statement not covered" >[];<span class="cstat-no" title="statement not covered" >if(!a)<span class="cstat-no" title="statement not covered" >return a;<span class="cstat-no" title="statement not covered" >a</span></span>=this.utf8_encode(a+"");<span class="cstat-no" title="statement not covered" >d</span>o <span class="cstat-no" title="statement not covered" >c=a.charCodeAt(k++),d=a.charCodeAt(k++),e=a.charCodeAt(k++),j=c&lt;&lt;16|d&lt;&lt;8|e,f=j&gt;&gt;18&amp;63,g=j&gt;&gt;12&amp;63,h=j&gt;&gt;6&amp;63,i=63&amp;j,n[l++]=b.charAt(f)+b.charAt(g)+b.charAt(h)+b.charAt(i);while(k&lt;a.length);<span class="cstat-no" title="statement not covered" >s</span>witch(m=n.join(""),a.length%3){case 1:<span class="cstat-no" title="statement not covered" >m=m.slice(0,-2)+"==";<span class="cstat-no" title="statement not covered" >b</span>reak;c</span>ase 2:<span class="cstat-no" title="statement not covered" >m=m.slice(0,-1)+"="}<span class="cstat-no" title="statement not covered" >r</span>eturn m},</span>this.URLSafeBase64Encode=<span class="fstat-no" title="function not covered" >function(</span>a){<span class="cstat-no" title="statement not covered" >return a=this.base64_encode(a),a.replace(/\//g,"_").replace(/\+/g,"-")},</span>this.URLSafeBase64Decode=<span class="fstat-no" title="function not covered" >function(</span>a){<span class="cstat-no" title="statement not covered" >return a=a.replace(/_/g,"/").replace(/-/g,"+"),this.base64_decode(a)},</span>this.createAjax=<span class="fstat-no" title="function not covered" >function(</span>a){var b=<span class="cstat-no" title="statement not covered" >{};<span class="cstat-no" title="statement not covered" >return b=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP")},</span>this.parseJSON=<span class="fstat-no" title="function not covered" >function(</span>data){<span class="cstat-no" title="statement not covered" >if(window.JSON&amp;&amp;window.JSON.parse)<span class="cstat-no" title="statement not covered" >return window.JSON.parse(data);v</span></span>ar rx_dangerous=<span class="cstat-no" title="statement not covered" >/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;var text=<span class="cstat-no" title="statement not covered" >String(data);<span class="cstat-no" title="statement not covered" >return rx_dangerous.lastIndex=0,rx_dangerous.test(text)&amp;&amp;(text=text.replace(rx_dangerous,<span class="fstat-no" title="function not covered" >function(</span>a){<span class="cstat-no" title="statement not covered" >return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})</span>),eval("("+text+")")},</span>this.stringifyJSON=<span class="fstat-no" title="function not covered" >function(</span>a){<span class="cstat-no" title="statement not covered" >if(window.JSON&amp;&amp;window.JSON.stringify)<span class="cstat-no" title="statement not covered" >return window.JSON.stringify(a);<span class="cstat-no" title="statement not covered" >s</span></span>witch(typeof a){case"string":<span class="cstat-no" title="statement not covered" >return'"'+a.replace(/(["\\])/g,"\\$1")+'"';c</span>ase"array":<span class="cstat-no" title="statement not covered" >return"["+a.map(that.stringifyJSON).join(",")+"]";c</span>ase"object":<span class="cstat-no" title="statement not covered" >if(a instanceof Array){var b=<span class="cstat-no" title="statement not covered" >[];var c=<span class="cstat-no" title="statement not covered" >a.length;<span class="cstat-no" title="statement not covered" >for(var d=0;c&gt;d;d++)<span class="cstat-no" title="statement not covered" >b.push(that.stringifyJSON(a[d]));<span class="cstat-no" title="statement not covered" >r</span></span>eturn"["+b.join(",")+"]"}<span class="cstat-no" title="statement not covered" >i</span></span>f(null===a)<span class="cstat-no" title="statement not covered" >return"null";v</span></span>ar e=<span class="cstat-no" title="statement not covered" >[];<span class="cstat-no" title="statement not covered" >for(var f in a)<span class="cstat-no" title="statement not covered" >a.hasOwnProperty(f)&amp;&amp;e.push(that.stringifyJSON(f)+":"+that.stringifyJSON(a[f]));<span class="cstat-no" title="statement not covered" >r</span></span>eturn"{"+e.join(",")+"}";c</span>ase"number":<span class="cstat-no" title="statement not covered" >return a;c</span>ase!1:<span class="cstat-no" title="statement not covered" >return a;c</span>ase"boolean":<span class="cstat-no" title="statement not covered" >return a}},</span>this.trim=<span class="fstat-no" title="function not covered" >function(</span>a){<span class="cstat-no" title="statement not covered" >return null===a?"":a.replace(/^\s+|\s+$/g,"")},</span>this.uploader=<span class="fstat-no" title="function not covered" >function(</span>a){var b=<span class="cstat-no" title="statement not covered" ><span class="fstat-no" title="function not covered" >function()</span>{var b=<span class="cstat-no" title="statement not covered" >that.detectIEVersion();var c,d,e;var f=<span class="cstat-no" title="statement not covered" >"Safari"===moxie.core.utils.Env.browser&amp;&amp;moxie.core.utils.Env.version&lt;=5&amp;&amp;"Windows"===moxie.core.utils.Env.os&amp;&amp;"7"===moxie.core.utils.Env.osVersion||"Safari"===moxie.core.utils.Env.browser&amp;&amp;"iOS"===moxie.core.utils.Env.os&amp;&amp;"7"===moxie.core.utils.Env.osVersion;<span class="cstat-no" title="statement not covered" >b&amp;&amp;9&gt;b&amp;&amp;a.chunk_size&amp;&amp;a.runtimes.indexOf("flash")&gt;=0?a.chunk_size=0:f?a.chunk_size=0:(c=20,d=4&lt;&lt;c,e=plupload.parseSize(a.chunk_size),e&gt;d&amp;&amp;(a.chunk_size=d))};</span>var c=<span class="cstat-no" title="statement not covered" ><span class="fstat-no" title="function not covered" >function(</span>a){var b=<span class="cstat-no" title="statement not covered" >[];var c=<span class="cstat-no" title="statement not covered" >-1;<span class="cstat-no" title="statement not covered" >for(var d=0;d&lt;a.length;d++){var e=<span class="cstat-no" title="statement not covered" >a[d];<span class="cstat-no" title="statement not covered" >-1!==e.indexOf("upload")&amp;&amp;(c=d),0===e.indexOf("-H")?b.push(e.split(" ")[2]):b.push(e)}<span class="cstat-no" title="statement not covered" >i</span></span>f(-1!==c){var f=<span class="cstat-no" title="statement not covered" >b[c];<span class="cstat-no" title="statement not covered" >b[c]=b[0],b[0]=f}<span class="cstat-no" title="statement not covered" >r</span></span>eturn b};</span>var d=<span class="cstat-no" title="statement not covered" ><span class="fstat-no" title="function not covered" >function(</span>a){var b=<span class="cstat-no" title="statement not covered" >a.split(":");var c=<span class="cstat-no" title="statement not covered" >b[0];var d=<span class="cstat-no" title="statement not covered" >that.parseJSON(that.URLSafeBase64Decode(b[2]));<span class="cstat-no" title="statement not covered" >return d.ak=c,d.scope.indexOf(":")&gt;=0?(d.bucket=d.scope.split(":")[0],d.key=d.scope.split(":")[1]):d.bucket=d.scope,d};</span>var e=<span class="cstat-no" title="statement not covered" ><span class="fstat-no" title="function not covered" >function(</span>b){var e=<span class="cstat-no" title="statement not covered" >d(b);var f=<span class="cstat-no" title="statement not covered" >window.location.protocol+"//uc.qbox.me/v1/query?ak="+e.ak+"&amp;bucket="+e.bucket;<span class="cstat-no" title="statement not covered" >logger.debug("putPolicy: ",e),logger.debug("get uphosts from: ",f);v</span>ar g=<span class="cstat-no" title="statement not covered" >that.detectIEVersion();var h;<span class="cstat-no" title="statement not covered" >g&amp;&amp;9&gt;=g?(h=new moxie.xhr.XMLHttpRequest,moxie.core.utils.Env.swf_url=a.flash_swf_url):h=that.createAjax(),h.open("GET",f,!1);v</span>ar i=<span class="cstat-no" title="statement not covered" ><span class="fstat-no" title="function not covered" >function()</span>{<span class="cstat-no" title="statement not covered" >if(logger.debug("ajax.readyState: ",h.readyState),4===h.readyState)<span class="cstat-no" title="statement not covered" >if(logger.debug("ajax.status: ",h.status),h.status&lt;400){var a=<span class="cstat-no" title="statement not covered" >that.parseJSON(h.responseText);<span class="cstat-no" title="statement not covered" >qiniuUpHosts.http=c(a.http.up),qiniuUpHosts.https=c(a.https.up),logger.debug("get new uphosts: ",qiniuUpHosts),that.resetUploadUrl()}e</span>lse <span class="cstat-no" title="statement not covered" >logger.error("get uphosts error: ",h.responseText)};<span class="cstat-no" title="statement not covered" ></span></span></span>g&amp;&amp;9&gt;=g?h.bind("readystatechange",i):h.onreadystatechange=i,h.send()};</span>var f=<span class="cstat-no" title="statement not covered" ><span class="fstat-no" title="function not covered" >function(</span>b){<span class="cstat-no" title="statement not covered" >return!that.token||a.uptoken_url&amp;&amp;that.tokenInfo.isExpired()?g(b):that.token};</span>var g=<span class="cstat-no" title="statement not covered" ><span class="fstat-no" title="function not covered" >function(</span>b){<span class="cstat-no" title="statement not covered" >if(a.uptoken)<span class="cstat-no" title="statement not covered" >that.token=a.uptoken;else <span class="cstat-no" title="statement not covered" >if(a.uptoken_url){<span class="cstat-no" title="statement not covered" >logger.debug("get uptoken from: ",that.uptoken_url);v</span>ar c=<span class="cstat-no" title="statement not covered" >that.createAjax();<span class="cstat-no" title="statement not covered" >if(c.open("GET",that.uptoken_url+"?"+ +new Date,!1),c.send(),200===c.status){var d=<span class="cstat-no" title="statement not covered" >that.parseJSON(c.responseText);<span class="cstat-no" title="statement not covered" >that.token=d.uptoken;v</span>ar f=<span class="cstat-no" title="statement not covered" >that.token.split(":");var g=<span class="cstat-no" title="statement not covered" >that.parseJSON(that.URLSafeBase64Decode(f[2]));<span class="cstat-no" title="statement not covered" >that.tokenMap||(that.tokenMap={});v</span>ar h=<span class="cstat-no" title="statement not covered" ><span class="fstat-no" title="function not covered" >function(</span>a){<span class="cstat-no" title="statement not covered" >return Math.ceil(a.getTime()/1e3)};</span>var i=<span class="cstat-no" title="statement not covered" >h(new Date(c.getResponseHeader("date")));var j=<span class="cstat-no" title="statement not covered" >h(new Date);<span class="cstat-no" title="statement not covered" >that.tokenInfo={serverDelay:j-i,deadline:g.deadline/1e3,isExpired:<span class="fstat-no" title="function not covered" >function()</span>{var a=<span class="cstat-no" title="statement not covered" >this.deadline-h(new Date)+this.serverDelay;<span class="cstat-no" title="statement not covered" >return 600&gt;a}}</span>,logger.debug("get new uptoken: ",that.token),logger.debug("get token info: ",that.tokenInfo)}e</span>lse <span class="cstat-no" title="statement not covered" >logger.error("get uptoken error: ",c.responseText)}e</span></span>lse <span class="cstat-no" title="statement not covered" >a.uptoken_func?(logger.debug("get uptoken from uptoken_func"),that.token=a.uptoken_func(b),logger.debug("get new uptoken: ",that.token)):logger.error("one of [uptoken, uptoken_url, uptoken_func] settings in options is required!");<span class="cstat-no" title="statement not covered" >r</span></span></span>eturn that.token&amp;&amp;e(that.token),that.token};</span>var h=<span class="cstat-no" title="statement not covered" ><span class="fstat-no" title="function not covered" >function(</span>b,c,d){var e=<span class="cstat-no" title="statement not covered" >"",f=<span class="cstat-no" title="statement not covered" >!1;<span class="cstat-no" title="statement not covered" >if(!a.save_key)<span class="cstat-no" title="statement not covered" >if(f=b.getOption&amp;&amp;b.getOption("unique_names"),f=f||b.settings&amp;&amp;b.settings.unique_names){var g=<span class="cstat-no" title="statement not covered" >that.getFileExtension(c.name);<span class="cstat-no" title="statement not covered" >e=g?c.id+"."+g:c.id}e</span>lse <span class="cstat-no" title="statement not covered" >e="function"==typeof d?d(b,c):c.name;<span class="cstat-no" title="statement not covered" >r</span></span></span>eturn e};</span>var i=<span class="cstat-no" title="statement not covered" ><span class="fstat-no" title="function not covered" >function(</span>a){<span class="cstat-no" title="statement not covered" >if(a&amp;&amp;a.match){var b=<span class="cstat-no" title="statement not covered" >a.match(/^https?:\/\/([^:^\/]*)/);<span class="cstat-no" title="statement not covered" >return b?b[1]:""}<span class="cstat-no" title="statement not covered" >r</span></span>eturn""};</span>var j=<span class="cstat-no" title="statement not covered" ><span class="fstat-no" title="function not covered" >function(</span>a){<span class="cstat-no" title="statement not covered" >if(a&amp;&amp;a.match){var b=<span class="cstat-no" title="statement not covered" >a.match(/(^https?)/);<span class="cstat-no" title="statement not covered" >if(!b)<span class="cstat-no" title="statement not covered" >return"";v</span></span>ar c=<span class="cstat-no" title="statement not covered" >b[1];<span class="cstat-no" title="statement not covered" >return b=a.match(/^https?:\/\/([^:^\/]*):(\d*)/),b?b[2]:"http"===c?"80":"443"}<span class="cstat-no" title="statement not covered" >r</span></span>eturn""};<span class="cstat-no" title="statement not covered" ></span>if(a.log_level&amp;&amp;(logger.level=a.log_level),!a.domain)<span class="cstat-no" title="statement not covered" >throw"domain setting in options is required!";<span class="cstat-no" title="statement not covered" >i</span></span>f(!a.browse_button)<span class="cstat-no" title="statement not covered" >throw"browse_button setting in options is required!";<span class="cstat-no" title="statement not covered" >i</span></span>f(!a.uptoken&amp;&amp;!a.uptoken_url&amp;&amp;!a.uptoken_func)<span class="cstat-no" title="statement not covered" >throw"one of [uptoken, uptoken_url, uptoken_func] settings in options is required!";<span class="cstat-no" title="statement not covered" >l</span></span>ogger.debug("init uploader start"),logger.debug("environment: ",moxie.core.utils.Env),logger.debug("userAgent: ",navigator.userAgent);v</span>ar k=<span class="cstat-no" title="statement not covered" >{};var l=<span class="cstat-no" title="statement not covered" >a.init&amp;&amp;a.init.Error;var m=<span class="cstat-no" title="statement not covered" >a.init&amp;&amp;a.init.FileUploaded;<span class="cstat-no" title="statement not covered" >a.init.Error=<span class="fstat-no" title="function not covered" >function()</span>{},a.init.FileUploaded=<span class="fstat-no" title="function not covered" >function()</span>{},that.uptoken_url=a.uptoken_url,that.token="",that.key_handler="function"==typeof a.init.Key?a.init.Key:"",this.domain=a.domain;v</span>ar n=<span class="cstat-no" title="statement not covered" >"";var o=<span class="cstat-no" title="statement not covered" >{isResumeUpload:!1,resumeFilesize:0,startTime:"",currentTime:""};<span class="cstat-no" title="statement not covered" >b(),logger.debug("invoke reset_chunk_size()"),logger.debug("op.chunk_size: ",a.chunk_size);v</span>ar p=<span class="cstat-no" title="statement not covered" >{url:qiniuUploadUrl,multipart_params:{token:""}};var q=<span class="cstat-no" title="statement not covered" >that.detectIEVersion();<span class="cstat-no" title="statement not covered" >q&amp;&amp;9&gt;=q&amp;&amp;(p.multipart_params.accept="text/plain; charset=utf-8",logger.debug("add accept text/plain in multipart params")),plupload.extend(k,a,p),logger.debug("option: ",k);v</span>ar r=<span class="cstat-no" title="statement not covered" >new plupload.Uploader(k);<span class="cstat-no" title="statement not covered" >logger.debug("new plupload.Uploader(option)"),r.bind("Init",<span class="fstat-no" title="function not covered" >function(</span>b,c){<span class="cstat-no" title="statement not covered" >logger.debug("Init event activated"),a.get_new_uptoken||g(null)})</span>,logger.debug("bind Init event"),r.bind("FilesAdded",<span class="fstat-no" title="function not covered" >function(</span>a,b){<span class="cstat-no" title="statement not covered" >logger.debug("FilesAdded event activated");v</span>ar c=<span class="cstat-no" title="statement not covered" >a.getOption&amp;&amp;a.getOption("auto_start");<span class="cstat-no" title="statement not covered" >c=c||a.settings&amp;&amp;a.settings.auto_start,logger.debug("auto_start: ",c),logger.debug("files: ",b);v</span>ar d=<span class="cstat-no" title="statement not covered" ><span class="fstat-no" title="function not covered" >function()</span>{<span class="cstat-no" title="statement not covered" >return"ios"===moxie.core.utils.Env.OS.toLowerCase()?!0:!1};<span class="cstat-no" title="statement not covered" ></span>if(d())<span class="cstat-no" title="statement not covered" >for(var e=0;e&lt;b.length;e++){var f=<span class="cstat-no" title="statement not covered" >b[e];var g=<span class="cstat-no" title="statement not covered" >that.getFileExtension(f.name);<span class="cstat-no" title="statement not covered" >f.name=f.id+"."+g}<span class="cstat-no" title="statement not covered" >c</span></span></span>&amp;&amp;setTimeout(<span class="fstat-no" title="function not covered" >function()</span>{<span class="cstat-no" title="statement not covered" >a.start(),logger.debug("invoke up.start()")},</span>0),a.refresh()})</span>,logger.debug("bind FilesAdded event"),r.bind("BeforeUpload",<span class="fstat-no" title="function not covered" >function(</span>b,c){<span class="cstat-no" title="statement not covered" >logger.debug("BeforeUpload event activated"),c._start_at=new Date,c.speed=c.speed||0,n="",a.get_new_uptoken&amp;&amp;g(c);v</span>ar d=<span class="cstat-no" title="statement not covered" ><span class="fstat-no" title="function not covered" >function(</span>b,c,d){<span class="cstat-no" title="statement not covered" >o.startTime=(new Date).getTime();v</span>ar f;<span class="cstat-no" title="statement not covered" >f=a.save_key?{token:that.token}:{key:h(b,c,d),token:that.token};v</span>ar g=<span class="cstat-no" title="statement not covered" >that.detectIEVersion();<span class="cstat-no" title="statement not covered" >g&amp;&amp;9&gt;=g&amp;&amp;(f.accept="text/plain; charset=utf-8",logger.debug("add accept text/plain in multipart params")),logger.debug("directUpload multipart_params_obj: ",f);v</span>ar i=<span class="cstat-no" title="statement not covered" >a.x_vars;<span class="cstat-no" title="statement not covered" >if(void 0!==i&amp;&amp;"object"==typeof i)<span class="cstat-no" title="statement not covered" >for(var j in i)<span class="cstat-no" title="statement not covered" >i.hasOwnProperty(j)&amp;&amp;("function"==typeof i[j]?f["x:"+j]=i[j](b,c):"object"!=typeof i[j]&amp;&amp;(f["x:"+j]=i[j]));<span class="cstat-no" title="statement not covered" >b</span></span></span>.setOption({url:qiniuUploadUrl,multipart:!0,chunk_size:e()?a.max_file_size:void 0,multipart_params:f})};</span>var e=<span class="cstat-no" title="statement not covered" ><span class="fstat-no" title="function not covered" >function()</span>{var a=<span class="cstat-no" title="statement not covered" >navigator.userAgent.toLowerCase();<span class="cstat-no" title="statement not covered" >return(a.match(/MicroMessenger/i)||"QQBrowser"===moxie.core.utils.Env.browser||a.match(/V1_AND_SQ/i))&amp;&amp;"android"===moxie.core.utils.Env.OS.toLowerCase()?!0:!1};</span>var i=<span class="cstat-no" title="statement not covered" >b.getOption&amp;&amp;b.getOption("chunk_size");<span class="cstat-no" title="statement not covered" >if(i=i||b.settings&amp;&amp;b.settings.chunk_size,logger.debug("uploader.runtime: ",r.runtime),logger.debug("chunk_size: ",i),"html5"!==r.runtime&amp;&amp;"flash"!==r.runtime||!i)<span class="cstat-no" title="statement not covered" >logger.debug("directUpload because uploader.runtime !== 'html5' || uploader.runtime !== 'flash' || !chunk_size"),d(b,c,that.key_handler);else <span class="cstat-no" title="statement not covered" >if(c.size&lt;i||e())<span class="cstat-no" title="statement not covered" >logger.debug("directUpload because file.size &lt; chunk_size || is_android_weixin_or_qq()"),d(b,c,that.key_handler);else{var j=<span class="cstat-no" title="statement not covered" >localStorage.getItem(c.name);var k=<span class="cstat-no" title="statement not covered" >i;<span class="cstat-no" title="statement not covered" >if(j){<span class="cstat-no" title="statement not covered" >j=that.parseJSON(j);v</span>ar l=(<span class="cstat-no" title="statement not covered" >new Date).getTime();var m=<span class="cstat-no" title="statement not covered" >j.time||0;var p=<span class="cstat-no" title="statement not covered" >864e5;<span class="cstat-no" title="statement not covered" >p&gt;l-m&amp;&amp;100!==j.percent&amp;&amp;c.size===j.total?(c.percent=j.percent,c.loaded=j.offset,n=j.ctx,o.isResumeUpload=!0,o.resumeFilesize=j.offset,j.offset+k&gt;c.size&amp;&amp;(k=c.size-j.offset)):localStorage.removeItem(c.name)}<span class="cstat-no" title="statement not covered" >o</span></span>.startTime=(new Date).getTime();v</span>ar q=<span class="cstat-no" title="statement not covered" >{};var s=<span class="cstat-no" title="statement not covered" >that.detectIEVersion();<span class="cstat-no" title="statement not covered" >s&amp;&amp;9&gt;=s&amp;&amp;(q.accept="text/plain; charset=utf-8",logger.debug("add accept text/plain in multipart params")),b.setOption({url:qiniuUploadUrl+"/mkblk/"+k,multipart:!1,chunk_size:i,required_features:"chunks",headers:{Authorization:"UpToken "+f(c)},multipart_params:q})}}</span>)</span></span>,logger.debug("bind BeforeUpload event"),r.bind("UploadProgress",<span class="fstat-no" title="function not covered" >function(</span>a,b){<span class="cstat-no" title="statement not covered" >logger.trace("UploadProgress event activated"),o.currentTime=(new Date).getTime();v</span>ar c=<span class="cstat-no" title="statement not covered" >o.currentTime-o.startTime;var d=<span class="cstat-no" title="statement not covered" >b.loaded||0;<span class="cstat-no" title="statement not covered" >o.isResumeUpload&amp;&amp;(d=b.loaded-o.resumeFilesize),b.speed=(d/c*1e3).toFixed(0)||0})</span>,logger.debug("bind UploadProgress event"),r.bind("ChunkUploaded",<span class="fstat-no" title="function not covered" >function(</span>a,b,c){<span class="cstat-no" title="statement not covered" >logger.debug("ChunkUploaded event activated"),logger.debug("ChunkUploaded file: ",b),logger.debug("ChunkUploaded info: ",c);v</span>ar d=<span class="cstat-no" title="statement not covered" >that.parseJSON(c.response);<span class="cstat-no" title="statement not covered" >logger.debug("ChunkUploaded res: ",d),n=n?n+","+d.ctx:d.ctx;v</span>ar e=<span class="cstat-no" title="statement not covered" >c.total-c.offset;var g=<span class="cstat-no" title="statement not covered" >a.getOption&amp;&amp;a.getOption("chunk_size");<span class="cstat-no" title="statement not covered" >g=g||a.settings&amp;&amp;a.settings.chunk_size,g&gt;e&amp;&amp;(a.setOption({url:qiniuUploadUrl+"/mkblk/"+e}),logger.debug("up.setOption url: ",qiniuUploadUrl+"/mkblk/"+e)),a.setOption({headers:{Authorization:"UpToken "+f(b)}}),localStorage.setItem(b.name,that.stringifyJSON({ctx:n,percent:b.percent,total:c.total,offset:c.offset,time:(new Date).getTime()}))})</span>,logger.debug("bind ChunkUploaded event");v</span>ar s=<span class="cstat-no" title="statement not covered" >qiniuUploadUrls.length;var t=<span class="cstat-no" title="statement not covered" ><span class="fstat-no" title="function not covered" >function(</span>a){<span class="cstat-no" title="statement not covered" >return s--&gt;0?(setTimeout(<span class="fstat-no" title="function not covered" >function()</span>{<span class="cstat-no" title="statement not covered" >that.resetUploadUrl(),a.status=plupload.QUEUED,r.stop(),r.start()},</span>0),!0):(s=qiniuUploadUrls.length,!1)};<span class="cstat-no" title="statement not covered" ></span>return r.bind("Error",<span class="fstat-no" title="function not covered" >function(</span>b){<span class="cstat-no" title="statement not covered" >return <span class="fstat-no" title="function not covered" >function(</span>c,d){<span class="cstat-no" title="statement not covered" >logger.error("Error event activated"),logger.error("err: ",d);v</span>ar e=<span class="cstat-no" title="statement not covered" >new Date;var f=<span class="cstat-no" title="statement not covered" >"";var g=<span class="cstat-no" title="statement not covered" >d.file;<span class="cstat-no" title="statement not covered" >if(g){<span class="cstat-no" title="statement not covered" >switch(d.code){case plupload.FAILED:<span class="cstat-no" title="statement not covered" >f="\u4e0a\u4f20\u5931\u8d25\u3002\u8bf7\u7a0d\u540e\u518d\u8bd5\u3002";<span class="cstat-no" title="statement not covered" >b</span>reak;c</span>ase plupload.FILE_SIZE_ERROR:var h=<span class="cstat-no" title="statement not covered" >c.getOption&amp;&amp;c.getOption("max_file_size");<span class="cstat-no" title="statement not covered" >h=h||c.settings&amp;&amp;c.settings.max_file_size,f="\u6d4f\u89c8\u5668\u6700\u5927\u53ef\u4e0a\u4f20"+h+"\u3002\u66f4\u5927\u6587\u4ef6\u8bf7\u4f7f\u7528\u547d\u4ee4\u884c\u5de5\u5177\u3002";<span class="cstat-no" title="statement not covered" >b</span>reak;c</span>ase plupload.FILE_EXTENSION_ERROR:<span class="cstat-no" title="statement not covered" >f="\u6587\u4ef6\u9a8c\u8bc1\u5931\u8d25\u3002\u8bf7\u7a0d\u540e\u91cd\u8bd5\u3002";<span class="cstat-no" title="statement not covered" >b</span>reak;c</span>ase plupload.HTTP_ERROR:<span class="cstat-no" title="statement not covered" >if(""===d.response){<span class="cstat-no" title="statement not covered" >if(f=d.message||"\u672a\u77e5\u7f51\u7edc\u9519\u8bef\u3002",!t(g))<span class="cstat-no" title="statement not covered" >return;<span class="cstat-no" title="statement not covered" >b</span></span>reak}v</span></span>ar k=<span class="cstat-no" title="statement not covered" >that.parseJSON(d.response);var l=<span class="cstat-no" title="statement not covered" >k.error;<span class="cstat-no" title="statement not covered" >switch(d.status){case 400:<span class="cstat-no" title="statement not covered" >f="\u8bf7\u6c42\u62a5\u6587\u683c\u5f0f\u9519\u8bef\u3002";<span class="cstat-no" title="statement not covered" >b</span>reak;c</span>ase 401:<span class="cstat-no" title="statement not covered" >f="\u5ba2\u6237\u7aef\u8ba4\u8bc1\u6388\u6743\u5931\u8d25\u3002\u8bf7\u91cd\u8bd5\u6216\u63d0\u4ea4\u53cd\u9988\u3002";<span class="cstat-no" title="statement not covered" >b</span>reak;c</span>ase 405:<span class="cstat-no" title="statement not covered" >f="\u5ba2\u6237\u7aef\u8bf7\u6c42\u9519\u8bef\u3002\u8bf7\u91cd\u8bd5\u6216\u63d0\u4ea4\u53cd\u9988\u3002";<span class="cstat-no" title="statement not covered" >b</span>reak;c</span>ase 579:<span class="cstat-no" title="statement not covered" >f="\u8d44\u6e90\u4e0a\u4f20\u6210\u529f\uff0c\u4f46\u56de\u8c03\u5931\u8d25\u3002";<span class="cstat-no" title="statement not covered" >b</span>reak;c</span>ase 599:<span class="cstat-no" title="statement not covered" >if(f="\u7f51\u7edc\u8fde\u63a5\u5f02\u5e38\u3002\u8bf7\u91cd\u8bd5\u6216\u63d0\u4ea4\u53cd\u9988\u3002",!t(g))<span class="cstat-no" title="statement not covered" >return;<span class="cstat-no" title="statement not covered" >b</span></span>reak;c</span>ase 614:<span class="cstat-no" title="statement not covered" >f="\u6587\u4ef6\u5df2\u5b58\u5728\u3002";<span class="cstat-no" title="statement not covered" >t</span>ry{<span class="cstat-no" title="statement not covered" >k=that.parseJSON(k.error),l=k.error||"file exists"}c</span>atch(m){<span class="cstat-no" title="statement not covered" >l=k.error||"file exists"}<span class="cstat-no" title="statement not covered" >b</span></span>reak;c</span>ase 631:<span class="cstat-no" title="statement not covered" >f="\u6307\u5b9a\u7a7a\u95f4\u4e0d\u5b58\u5728\u3002";<span class="cstat-no" title="statement not covered" >b</span>reak;c</span>ase 701:<span class="cstat-no" title="statement not covered" >f="\u4e0a\u4f20\u6570\u636e\u5757\u6821\u9a8c\u51fa\u9519\u3002\u8bf7\u91cd\u8bd5\u6216\u63d0\u4ea4\u53cd\u9988\u3002";<span class="cstat-no" title="statement not covered" >b</span>reak;d</span>efault:<span class="cstat-no" title="statement not covered" >if(f="\u672a\u77e5\u9519\u8bef\u3002",!t(g))<span class="cstat-no" title="statement not covered" >return}<span class="cstat-no" title="statement not covered" >f</span>=f+"("+d.status+"\uff1a"+l+")";<span class="cstat-no" title="statement not covered" >b</span>reak;c</span>ase plupload.SECURITY_ERROR:<span class="cstat-no" title="statement not covered" >f="\u5b89\u5168\u914d\u7f6e\u9519\u8bef\u3002\u8bf7\u8054\u7cfb\u7f51\u7ad9\u7ba1\u7406\u5458\u3002";<span class="cstat-no" title="statement not covered" >b</span>reak;c</span>ase plupload.GENERIC_ERROR:<span class="cstat-no" title="statement not covered" >f="\u4e0a\u4f20\u5931\u8d25\u3002\u8bf7\u7a0d\u540e\u518d\u8bd5\u3002";<span class="cstat-no" title="statement not covered" >b</span>reak;c</span>ase plupload.IO_ERROR:<span class="cstat-no" title="statement not covered" >f="\u4e0a\u4f20\u5931\u8d25\u3002\u8bf7\u7a0d\u540e\u518d\u8bd5\u3002";<span class="cstat-no" title="statement not covered" >b</span>reak;c</span>ase plupload.INIT_ERROR:<span class="cstat-no" title="statement not covered" >f="\u7f51\u7ad9\u914d\u7f6e\u9519\u8bef\u3002\u8bf7\u8054\u7cfb\u7f51\u7ad9\u7ba1\u7406\u5458\u3002",r.destroy();<span class="cstat-no" title="statement not covered" >b</span>reak;d</span>efault:<span class="cstat-no" title="statement not covered" >if(f=d.message+d.details,!t(g))<span class="cstat-no" title="statement not covered" >return}<span class="cstat-no" title="statement not covered" >b</span>&amp;&amp;b(c,d,f)}<span class="cstat-no" title="statement not covered" >i</span></span>f(c.refresh(),!a.disable_statistics_report){var n=<span class="cstat-no" title="statement not covered" >d&amp;&amp;d.responseHeaders&amp;&amp;d.responseHeaders.match?d.responseHeaders.match(/(X-Reqid\:\ )([\w\.\%-]*)/):[];<span class="cstat-no" title="statement not covered" >console.log(d);v</span>ar o=<span class="cstat-no" title="statement not covered" >n[2].replace(/[\r\n]/g,"");var p=<span class="cstat-no" title="statement not covered" >plupload.HTTP_ERROR?d.status:d.code;var q=<span class="cstat-no" title="statement not covered" >g._start_at?g._start_at.getTime():e.getTime();<span class="cstat-no" title="statement not covered" >statisticsLogger.log(0===p?ExtraErrors.NetworkError:p,o,i(c.settings.url),void 0,j(c.settings.url),(e.getTime()-q)/1e3,parseInt(q/1e3),d.file.size*(d.file.percent/100),"jssdk-"+c.runtime,g.size)}}</span>}</span>(</span>l)),logger.debug("bind Error event"),r.bind("FileUploaded",<span class="fstat-no" title="function not covered" >function(</span>b){<span class="cstat-no" title="statement not covered" >return <span class="fstat-no" title="function not covered" >function(</span>c,d,e){<span class="cstat-no" title="statement not covered" >logger.debug("FileUploaded event activated"),logger.debug("FileUploaded file: ",d),logger.debug("FileUploaded info: ",e);v</span>ar f=<span class="cstat-no" title="statement not covered" >new Date;var g=<span class="cstat-no" title="statement not covered" ><span class="fstat-no" title="function not covered" >function(</span>c,d,e){<span class="cstat-no" title="statement not covered" >if(logger.debug("FileUploaded last step:",e),a.downtoken_url){var f=<span class="cstat-no" title="statement not covered" >that.createAjax();<span class="cstat-no" title="statement not covered" >f.open("POST",a.downtoken_url,!0),f.setRequestHeader("Content-type","application/x-www-form-urlencoded"),f.onreadystatechange=<span class="fstat-no" title="function not covered" >function()</span>{<span class="cstat-no" title="statement not covered" >if(4===f.readyState)<span class="cstat-no" title="statement not covered" >if(200===f.status){var a;<span class="cstat-no" title="statement not covered" >try{<span class="cstat-no" title="statement not covered" >a=that.parseJSON(f.responseText)}c</span>atch(g){<span class="cstat-no" title="statement not covered" >throw"invalid json format"}v</span></span>ar h=<span class="cstat-no" title="statement not covered" >{};<span class="cstat-no" title="statement not covered" >plupload.extend(h,that.parseJSON(e.response),a),e.response=that.stringifyJSON(h),b&amp;&amp;b(c,d,e)}e</span>lse <span class="cstat-no" title="statement not covered" >r.trigger("Error",{status:f.status,response:f.responseText,file:d,code:plupload.HTTP_ERROR})},</span></span></span>f.send("key="+that.parseJSON(e.response).key+"&amp;domain="+a.domain)}e</span>lse <span class="cstat-no" title="statement not covered" >b&amp;&amp;b(c,d,e)};</span></span>var k=<span class="cstat-no" title="statement not covered" >that.parseJSON(e.response);<span class="cstat-no" title="statement not covered" >if(n=n?n:k.ctx,logger.debug("ctx: ",n),n){var l=<span class="cstat-no" title="statement not covered" >"";<span class="cstat-no" title="statement not covered" >logger.debug("save_key: ",a.save_key),a.save_key||(l=h(c,d,that.key_handler),l=l?"/key/"+that.URLSafeBase64Encode(l):"");v</span>ar m=<span class="cstat-no" title="statement not covered" >"/fname/"+that.URLSafeBase64Encode(d.name);<span class="cstat-no" title="statement not covered" >logger.debug("op.x_vars: ",a.x_vars);v</span>ar o=<span class="cstat-no" title="statement not covered" >a.x_vars,p=<span class="cstat-no" title="statement not covered" >"",q=<span class="cstat-no" title="statement not covered" >"";<span class="cstat-no" title="statement not covered" >if(void 0!==o&amp;&amp;"object"==typeof o)<span class="cstat-no" title="statement not covered" >for(var s in o)<span class="cstat-no" title="statement not covered" >o.hasOwnProperty(s)&amp;&amp;("function"==typeof o[s]?p=that.URLSafeBase64Encode(o[s](c,d)):"object"!=typeof o[s]&amp;&amp;(p=that.URLSafeBase64Encode(o[s])),q+="/x:"+s+"/"+p);v</span></span></span>ar t=<span class="cstat-no" title="statement not covered" >qiniuUploadUrl+"/mkfile/"+d.size+l+m+q;var u=<span class="cstat-no" title="statement not covered" >that.detectIEVersion();var v;<span class="cstat-no" title="statement not covered" >u&amp;&amp;9&gt;=u?(v=new moxie.xhr.XMLHttpRequest,moxie.core.utils.Env.swf_url=a.flash_swf_url):v=that.createAjax(),v.open("POST",t,!0),v.setRequestHeader("Content-Type","text/plain;charset=UTF-8"),console.log("uptoken:"+that.token),v.setRequestHeader("Authorization","UpToken "+that.token);v</span>ar w=<span class="cstat-no" title="statement not covered" ><span class="fstat-no" title="function not covered" >function()</span>{<span class="cstat-no" title="statement not covered" >if(logger.debug("ajax.readyState: ",v.readyState),4===v.readyState){<span class="cstat-no" title="statement not covered" >localStorage.removeItem(d.name);v</span>ar a;<span class="cstat-no" title="statement not covered" >200===v.status?(a={status:v.status,response:v.responseText,responseHeaders:v.getAllResponseHeaders()},logger.debug("mkfile is success: ",a),g(c,d,a)):(a={status:v.status,response:v.responseText,file:d,code:-200,responseHeaders:v.getAllResponseHeaders()},logger.debug("mkfile is error: ",a),r.trigger("Error",a))}}</span>;<span class="cstat-no" title="statement not covered" ></span>u&amp;&amp;9&gt;=u?v.bind("readystatechange",w):v.onreadystatechange=w,v.send(n),logger.debug("mkfile: ",t)}e</span>lse <span class="cstat-no" title="statement not covered" >g(c,d,e);<span class="cstat-no" title="statement not covered" >i</span></span>f(!a.disable_statistics_report){<span class="cstat-no" title="statement not covered" >console.log(e.responseHeaders);v</span>ar x=<span class="cstat-no" title="statement not covered" >e.responseHeaders.match(/(X-Reqid\:\ )([\w\.\%-]*)/i)[2].replace(/[\r\n]/g,"");var y=<span class="cstat-no" title="statement not covered" >d._start_at?d._start_at.getTime():f.getTime();<span class="cstat-no" title="statement not covered" >statisticsLogger.log(e.status,x,i(c.settings.url),void 0,j(c.settings.url),(f.getTime()-y)/1e3,parseInt(y/1e3),d.size,"jssdk-"+c.runtime,d.size)}}</span>}</span>(</span>m)),logger.debug("bind FileUploaded event"),r.bind("FilesRemoved",<span class="fstat-no" title="function not covered" >function(</span>b,c){var d=<span class="cstat-no" title="statement not covered" >new Date;<span class="cstat-no" title="statement not covered" >if(!a.disable_statistics_report)<span class="cstat-no" title="statement not covered" >for(var e=0;e&lt;c.length;e++)<span class="cstat-no" title="statement not covered" >statisticsLogger.log(ExtraErrors.Cancelled,void 0,i(b.settings.url),void 0,j(b.settings.url),(d.getTime()-c[e]._start_at.getTime())/1e3,c[e]._start_at.getTime()/1e3,c[e].size*c[e].percent/100,"jssdk-"+b.runtime,c[e].size)})</span></span></span>,logger.debug("bind FilesRemoved event"),r.init(),logger.debug("invoke uploader.init()"),logger.debug("init uploader end"),r},</span>this.getUrl=<span class="fstat-no" title="function not covered" >function(</span>a){<span class="cstat-no" title="statement not covered" >if(!a)<span class="cstat-no" title="statement not covered" >return!1;<span class="cstat-no" title="statement not covered" >a</span></span>=encodeURI(a);v</span>ar b=<span class="cstat-no" title="statement not covered" >this.domain;<span class="cstat-no" title="statement not covered" >return"/"!==b.slice(b.length-1)&amp;&amp;(b+="/"),b+a},</span>this.imageView2=<span class="fstat-no" title="function not covered" >function(</span>a,b){<span class="cstat-no" title="statement not covered" >if(!/^\d$/.test(a.mode))<span class="cstat-no" title="statement not covered" >return!1;v</span></span>ar c=<span class="cstat-no" title="statement not covered" >a.mode,d=<span class="cstat-no" title="statement not covered" >a.w||"",e=<span class="cstat-no" title="statement not covered" >a.h||"",f=<span class="cstat-no" title="statement not covered" >a.q||"",g=<span class="cstat-no" title="statement not covered" >a.format||"";<span class="cstat-no" title="statement not covered" >if(!d&amp;&amp;!e)<span class="cstat-no" title="statement not covered" >return!1;v</span></span>ar h=<span class="cstat-no" title="statement not covered" >"imageView2/"+c;<span class="cstat-no" title="statement not covered" >return h+=d?"/w/"+d:"",h+=e?"/h/"+e:"",h+=f?"/q/"+f:"",h+=g?"/format/"+g:"",b&amp;&amp;(h=this.getUrl(b)+"?"+h),h},</span>this.imageMogr2=<span class="fstat-no" title="function not covered" >function(</span>a,b){var c=<span class="cstat-no" title="statement not covered" >a["auto-orient"]||"",d=<span class="cstat-no" title="statement not covered" >a.thumbnail||"",e=<span class="cstat-no" title="statement not covered" >a.strip||"",f=<span class="cstat-no" title="statement not covered" >a.gravity||"",g=<span class="cstat-no" title="statement not covered" >a.crop||"",h=<span class="cstat-no" title="statement not covered" >a.quality||"",i=<span class="cstat-no" title="statement not covered" >a.rotate||"",j=<span class="cstat-no" title="statement not covered" >a.format||"",k=<span class="cstat-no" title="statement not covered" >a.blur||"";var l=<span class="cstat-no" title="statement not covered" >"imageMogr2";<span class="cstat-no" title="statement not covered" >return l+=c?"/auto-orient":"",l+=d?"/thumbnail/"+d:"",l+=e?"/strip":"",l+=f?"/gravity/"+f:"",l+=h?"/quality/"+h:"",l+=g?"/crop/"+g:"",l+=i?"/rotate/"+i:"",l+=j?"/format/"+j:"",l+=k?"/blur/"+k:"",b&amp;&amp;(l=this.getUrl(b)+"?"+l),l},</span>this.watermark=<span class="fstat-no" title="function not covered" >function(</span>a,b){var c=<span class="cstat-no" title="statement not covered" >a.mode;<span class="cstat-no" title="statement not covered" >if(!c)<span class="cstat-no" title="statement not covered" >return!1;v</span></span>ar d=<span class="cstat-no" title="statement not covered" >"watermark/"+c;<span class="cstat-no" title="statement not covered" >if(1===c){var e=<span class="cstat-no" title="statement not covered" >a.image||"";<span class="cstat-no" title="statement not covered" >if(!e)<span class="cstat-no" title="statement not covered" >return!1;<span class="cstat-no" title="statement not covered" >d</span></span>+=e?"/image/"+this.URLSafeBase64Encode(e):""}e</span>lse{<span class="cstat-no" title="statement not covered" >if(2!==c)<span class="cstat-no" title="statement not covered" >return!1;v</span></span>ar f=<span class="cstat-no" title="statement not covered" >a.text?a.text:"",g=<span class="cstat-no" title="statement not covered" >a.font?a.font:"",h=<span class="cstat-no" title="statement not covered" >a.fontsize?a.fontsize:"",i=<span class="cstat-no" title="statement not covered" >a.fill?a.fill:"";<span class="cstat-no" title="statement not covered" >if(!f)<span class="cstat-no" title="statement not covered" >return!1;<span class="cstat-no" title="statement not covered" >d</span></span>+=f?"/text/"+this.URLSafeBase64Encode(f):"",d+=g?"/font/"+this.URLSafeBase64Encode(g):"",d+=h?"/fontsize/"+h:"",d+=i?"/fill/"+this.URLSafeBase64Encode(i):""}v</span></span>ar j=<span class="cstat-no" title="statement not covered" >a.dissolve||"",k=<span class="cstat-no" title="statement not covered" >a.gravity||"",l=<span class="cstat-no" title="statement not covered" >a.dx||"",m=<span class="cstat-no" title="statement not covered" >a.dy||"";<span class="cstat-no" title="statement not covered" >return d+=j?"/dissolve/"+j:"",d+=k?"/gravity/"+k:"",d+=l?"/dx/"+l:"",d+=m?"/dy/"+m:"",b&amp;&amp;(d=this.getUrl(b)+"?"+d),d},</span>this.imageInfo=<span class="fstat-no" title="function not covered" >function(</span>a){<span class="cstat-no" title="statement not covered" >if(!a)<span class="cstat-no" title="statement not covered" >return!1;v</span></span>ar b=<span class="cstat-no" title="statement not covered" >this.getUrl(a)+"?imageInfo";var c=<span class="cstat-no" title="statement not covered" >this.createAjax();var d;var e=<span class="cstat-no" title="statement not covered" >this;<span class="cstat-no" title="statement not covered" >return c.open("GET",b,!1),c.onreadystatechange=<span class="fstat-no" title="function not covered" >function()</span>{<span class="cstat-no" title="statement not covered" >4===c.readyState&amp;&amp;200===c.status&amp;&amp;(d=e.parseJSON(c.responseText))},</span>c.send(),d},</span>this.exif=<span class="fstat-no" title="function not covered" >function(</span>a){<span class="cstat-no" title="statement not covered" >if(!a)<span class="cstat-no" title="statement not covered" >return!1;v</span></span>ar b=<span class="cstat-no" title="statement not covered" >this.getUrl(a)+"?exif";var c=<span class="cstat-no" title="statement not covered" >this.createAjax();var d;var e=<span class="cstat-no" title="statement not covered" >this;<span class="cstat-no" title="statement not covered" >return c.open("GET",b,!1),c.onreadystatechange=<span class="fstat-no" title="function not covered" >function()</span>{<span class="cstat-no" title="statement not covered" >4===c.readyState&amp;&amp;200===c.status&amp;&amp;(d=e.parseJSON(c.responseText))},</span>c.send(),d},</span>this.get=<span class="fstat-no" title="function not covered" >function(</span>a,b){<span class="cstat-no" title="statement not covered" >return b&amp;&amp;a?"exif"===a?this.exif(b):"imageInfo"===a?this.imageInfo(b):!1:!1},</span>this.pipeline=<span class="fstat-no" title="function not covered" >function(</span>a,b){var c=<span class="cstat-no" title="statement not covered" >"[object Array]"===Object.prototype.toString.call(a);var d,e,f=<span class="cstat-no" title="statement not covered" >"";<span class="cstat-no" title="statement not covered" >if(c){<span class="cstat-no" title="statement not covered" >for(var g=0,h=a.length;h&gt;g;g++){<span class="cstat-no" title="statement not covered" >if(d=a[g],!d.fop)<span class="cstat-no" title="statement not covered" >return!1;<span class="cstat-no" title="statement not covered" >s</span></span>witch(d.fop){case"watermark":<span class="cstat-no" title="statement not covered" >f+=this.watermark(d)+"|";<span class="cstat-no" title="statement not covered" >b</span>reak;c</span>ase"imageView2":<span class="cstat-no" title="statement not covered" >f+=this.imageView2(d)+"|";<span class="cstat-no" title="statement not covered" >b</span>reak;c</span>ase"imageMogr2":<span class="cstat-no" title="statement not covered" >f+=this.imageMogr2(d)+"|";<span class="cstat-no" title="statement not covered" >b</span>reak;d</span>efault:<span class="cstat-no" title="statement not covered" >e=!0}<span class="cstat-no" title="statement not covered" >i</span>f(e)<span class="cstat-no" title="statement not covered" >return!1}<span class="cstat-no" title="statement not covered" >i</span></span></span>f(b){<span class="cstat-no" title="statement not covered" >f=this.getUrl(b)+"?"+f;v</span>ar i=<span class="cstat-no" title="statement not covered" >f.length;<span class="cstat-no" title="statement not covered" >"|"===f.slice(i-1)&amp;&amp;(f=f.slice(0,i-1))}<span class="cstat-no" title="statement not covered" >r</span></span>eturn f}<span class="cstat-no" title="statement not covered" >r</span></span>eturn!1}}</span>v</span>ar Qiniu=<span class="cstat-no" title="statement not covered" >new QiniuJsSDK;<span class="cstat-no" title="statement not covered" >global.Qiniu=Qiniu,global.QiniuJsSDK=QiniuJsSDK}(</span>window);</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>
//# sourceMappingURL=dist/qiniu.min.map</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="https://istanbul.js.org/" target="_blank">istanbul</a> at Mon Dec 10 2018 09:52:44 GMT+0800 (GMT+08:00)
</div>
</div>
<script src="../../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../../sorter.js"></script>
</body>
</html>
